const { Client, AccountBalanceQuery, PrivateKey, AccountCreateTransaction, Hbar,
    AccountAllowanceApproveTransaction,
    TokenId,
    ContractId
} = require("@hashgraph/sdk");
require("dotenv").config();
const hre = require("hardhat");

const init = async () => {
    const operatorAccountId = process.env.TESTNET_OPERATOR_ACCOUNT_ID;
    const operatorPrivateKey = process.env.TESTNET_OPERATOR_PRIVATE_KEY_DER;

    if (!operatorAccountId || !operatorPrivateKey) {
        throw new Error("Environment variables must be present.");
    }

    const client = Client.forTestnet();
    client.setOperator(operatorAccountId, operatorPrivateKey);

    const clientAccount = { id: operatorAccountId, privateKey: operatorPrivateKey };
    console.log(`Client account init: ${clientAccount.id}, ${clientAccount.privateKey}`);

    //Create account for fee
    const feeAccount = {};
    const privateKey = PrivateKey.generateED25519();
    const publicKey = privateKey.publicKey;
    const account = await new AccountCreateTransaction()
        .setKey(publicKey)
        .execute(client);
    const { accountId } = await account.getReceipt(client);

    feeAccount.id = accountId;
    feeAccount.privateKey = privateKey;
    console.log(`Fee account init: ${feeAccount.id}, ${feeAccount.privateKey}`);

    const signers = await hre.ethers.getSigners();

    // [{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.469839","timestamp":{"from":"1691685087.749943003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.469852","timestamp":{"from":"1691685785.932650240","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.469862","timestamp":{"from":"1691686054.512964323","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.469889","timestamp":{"from":"1691686909.632234657","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.471649","timestamp":{"from":"1691754667.751753894","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.471654","timestamp":{"from":"1691754810.499056003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.471664","timestamp":{"from":"1691754927.893551003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472588","timestamp":{"from":"1691763126.324253003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472594","timestamp":{"from":"1691763228.366707301","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472600","timestamp":{"from":"1691763377.618395003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472690","timestamp":{"from":"1691768198.258867192","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472698","timestamp":{"from":"1691768336.717544003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472705","timestamp":{"from":"1691768535.983428576","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472711","timestamp":{"from":"1691768654.991534156","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.472717","timestamp":{"from":"1691768716.260125003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.473348","timestamp":{"from":"1691770678.200711880","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.473489","timestamp":{"from":"1691770953.370499003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.473548","timestamp":{"from":"1691771065.858663003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.473569","timestamp":{"from":"1691771241.756872003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.474310","timestamp":{"from":"1691778878.796356003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.474315","timestamp":{"from":"1691778998.873891951","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.474323","timestamp":{"from":"1691779083.037003736","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.474329","timestamp":{"from":"1691779287.524416931","to":null},"token_id":"0.0.59042"},{"amount":14763589696008,"amount_granted":14763589696008,"owner":"0.0.390072","spender":"0.0.474484","timestamp":{"from":"1691781399.497024172","to":null},"token_id":"0.0.59042"},{"amount":14,"amount_granted":14,"owner":"0.0.390072","spender":"0.0.474492","timestamp":{"from":"1691781707.140949313","to":null},"token_id":"0.0.59042"},{"amount":1476373546,"amount_granted":1476373546,"owner":"0.0.390072","spender":"0.0.474498","timestamp":{"from":"1691781918.240785743","to":null},"token_id":"0.0.59042"},{"amount":1631789343,"amount_granted":1631789343,"owner":"0.0.390072","spender":"0.0.474503","timestamp":{"from":"1691782045.841228118","to":null},"token_id":"0.0.59042"},{"amount":1631797398,"amount_granted":1631797398,"owner":"0.0.390072","spender":"0.0.474509","timestamp":{"from":"1691782315.021269160","to":null},"token_id":"0.0.59042"},{"amount":163180545435,"amount_granted":163180545435,"owner":"0.0.390072","spender":"0.0.474514","timestamp":{"from":"1691782416.988943825","to":null},"token_id":"0.0.59042"},{"amount":163181350991,"amount_granted":163181350991,"owner":"0.0.390072","spender":"0.0.474520","timestamp":{"from":"1691782566.130954003","to":null},"token_id":"0.0.59042"},{"amount":1631821565,"amount_granted":1631821565,"owner":"0.0.390072","spender":"0.0.474526","timestamp":{"from":"1691782676.701114077","to":null},"token_id":"0.0.59042"},{"amount":1631829621,"amount_granted":1631829621,"owner":"0.0.390072","spender":"0.0.474532","timestamp":{"from":"1691782808.695349718","to":null},"token_id":"0.0.59042"},{"amount":1,"amount_granted":1,"owner":"0.0.390072","spender":"0.0.474710","timestamp":{"from":"1691787131.464450614","to":null},"token_id":"0.0.59042"},{"amount":1,"amount_granted":1,"owner":"0.0.390072","spender":"0.0.474717","timestamp":{"from":"1691787244.802167003","to":null},"token_id":"0.0.59042"},{"amount":1,"amount_granted":1,"owner":"0.0.390072","spender":"0.0.474723","timestamp":{"from":"1691787358.073392428","to":null},"token_id":"0.0.59042"},{"amount":1,"amount_granted":1,"owner":"0.0.390072","spender":"0.0.474728","timestamp":{"from":"1691787452.534600003","to":null},"token_id":"0.0.59042"},{"amount":6773,"amount_granted":6773,"owner":"0.0.390072","spender":"0.0.474736","timestamp":{"from":"1691787580.800901003","to":null},"token_id":"0.0.59042"},{"amount":67730,"amount_granted":67730,"owner":"0.0.390072","spender":"0.0.474742","timestamp":{"from":"1691787663.624970901","to":null},"token_id":"0.0.59042"},{"amount":677292,"amount_granted":677292,"owner":"0.0.390072","spender":"0.0.474747","timestamp":{"from":"1691787747.589826003","to":null},"token_id":"0.0.59042"},{"amount":6772886,"amount_granted":6772886,"owner":"0.0.390072","spender":"0.0.474752","timestamp":{"from":"1691787828.930757003","to":null},"token_id":"0.0.59042"},{"amount":67728521,"amount_granted":67728521,"owner":"0.0.390072","spender":"0.0.474757","timestamp":{"from":"1691787907.064512177","to":null},"token_id":"0.0.59042"},{"amount":677281859,"amount_granted":677281859,"owner":"0.0.390072","spender":"0.0.474762","timestamp":{"from":"1691788000.376372036","to":null},"token_id":"0.0.59042"},{"amount":6772785150,"amount_granted":6772785150,"owner":"0.0.390072","spender":"0.0.474767","timestamp":{"from":"1691788086.720104003","to":null},"token_id":"0.0.59042"},{"amount":67727517164,"amount_granted":67727517164,"owner":"0.0.390072","spender":"0.0.474772","timestamp":{"from":"1691788166.731216003","to":null},"token_id":"0.0.59042"},{"amount":677271828353,"amount_granted":677271828353,"owner":"0.0.390072","spender":"0.0.474777","timestamp":{"from":"1691788291.825845475","to":null},"token_id":"0.0.59042"},{"amount":6772684851,"amount_granted":6772684851,"owner":"0.0.390072","spender":"0.0.474782","timestamp":{"from":"1691788558.221733956","to":null},"token_id":"0.0.59042"},{"amount":6772651419,"amount_granted":6772651419,"owner":"0.0.390072","spender":"0.0.474787","timestamp":{"from":"1691788748.076068248","to":null},"token_id":"0.0.59042"},{"amount":677261799,"amount_granted":677261799,"owner":"0.0.390072","spender":"0.0.474792","timestamp":{"from":"1691788917.462101818","to":null},"token_id":"0.0.59042"},{"amount":170000000,"amount_granted":170000000,"owner":"0.0.390072","spender":"0.0.474797","timestamp":{"from":"1691789418.136153248","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.474802","timestamp":{"from":"1691789592.493317003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.474807","timestamp":{"from":"1691789776.900585003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.476163","timestamp":{"from":"1691959157.224934642","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.476176","timestamp":{"from":"1691959274.566271003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.485547","timestamp":{"from":"1692051592.034929148","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.485553","timestamp":{"from":"1692051922.576987847","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.485559","timestamp":{"from":"1692052030.890752414","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.487035","timestamp":{"from":"1692093320.253109003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.487255","timestamp":{"from":"1692097390.963405205","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.487286","timestamp":{"from":"1692098075.798897003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.508522","timestamp":{"from":"1692274451.308101258","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.509593","timestamp":{"from":"1692276705.035344003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.509659","timestamp":{"from":"1692276852.651182153","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.619612","timestamp":{"from":"1692447482.339959003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.621148","timestamp":{"from":"1692452759.285036218","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.621169","timestamp":{"from":"1692452859.267857692","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.621192","timestamp":{"from":"1692452977.267341375","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.621481","timestamp":{"from":"1692454107.901238003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.621506","timestamp":{"from":"1692454202.979140003","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.622692","timestamp":{"from":"1692471147.257866267","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.622707","timestamp":{"from":"1692471908.946642086","to":null},"token_id":"0.0.59042"},{"amount":200000000,"amount_granted":200000000,"owner":"0.0.390072","spender":"0.0.622748","timestamp":{"from":"1692474446.892761003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622765","timestamp":{"from":"1692475737.979666181","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622765","timestamp":{"from":"1692475747.559324003","to":null},"token_id":"0.0.157962"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622779","timestamp":{"from":"1692476271.610939960","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622779","timestamp":{"from":"1692476282.773515003","to":null},"token_id":"0.0.157962"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622797","timestamp":{"from":"1692481700.000269003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622797","timestamp":{"from":"1692481712.468620003","to":null},"token_id":"0.0.157962"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622818","timestamp":{"from":"1692482565.015153093","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.622818","timestamp":{"from":"1692482576.880574561","to":null},"token_id":"0.0.157962"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623102","timestamp":{"from":"1692529547.173905003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623102","timestamp":{"from":"1692529560.610167003","to":null},"token_id":"0.0.157962"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623331","timestamp":{"from":"1692530353.460551003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623331","timestamp":{"from":"1692530367.162095003","to":null},"token_id":"0.0.157962"},{"amount":61,"amount_granted":61,"owner":"0.0.390072","spender":"0.0.623556","timestamp":{"from":"1692531367.836202633","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623556","timestamp":{"from":"1692531355.925770199","to":null},"token_id":"0.0.157962"},{"amount":148940478,"amount_granted":148940478,"owner":"0.0.390072","spender":"0.0.623611","timestamp":{"from":"1692531571.624110851","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623611","timestamp":{"from":"1692531559.878115307","to":null},"token_id":"0.0.157962"},{"amount":159745242,"amount_granted":159745242,"owner":"0.0.390072","spender":"0.0.623747","timestamp":{"from":"1692532013.118208003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623747","timestamp":{"from":"1692532001.713029003","to":null},"token_id":"0.0.157962"},{"amount":159747268,"amount_granted":159747268,"owner":"0.0.390072","spender":"0.0.623931","timestamp":{"from":"1692532616.009325608","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.623931","timestamp":{"from":"1692532604.377383782","to":null},"token_id":"0.0.157962"},{"amount":159749296,"amount_granted":159749296,"owner":"0.0.390072","spender":"0.0.624060","timestamp":{"from":"1692532929.040201003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.624060","timestamp":{"from":"1692532919.666923713","to":null},"token_id":"0.0.157962"},{"amount":159751323,"amount_granted":159751323,"owner":"0.0.390072","spender":"0.0.624105","timestamp":{"from":"1692533071.672844003","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.624105","timestamp":{"from":"1692533059.612964269","to":null},"token_id":"0.0.157962"},{"amount":159753351,"amount_granted":159753351,"owner":"0.0.390072","spender":"0.0.624323","timestamp":{"from":"1692533793.804076086","to":null},"token_id":"0.0.59042"},{"amount":173068861,"amount_granted":173068861,"owner":"0.0.390072","spender":"0.0.624323","timestamp":{"from":"1692533802.081871563","to":null},"token_id":"0.0.157962"},{"amount":159755378,"amount_granted":159755378,"owner":"0.0.390072","spender":"0.0.624396","timestamp":{"from":"1692534041.686586843","to":null},"token_id":"0.0.59042"},{"amount":100000000,"amount_granted":100000000,"owner":"0.0.390072","spender":"0.0.624396","timestamp":{"from":"1692534029.801102033","to":null},"token_id":"0.0.157962"},{"amount":159757406,"amount_granted":159757406,"owner":"0.0.390072","spender":"0.0.624544","timestamp":{"from":"1692534595.365126121","to":null},"token_id":"0.0.59042"}]
    //     .map(async allowance => {
    //         const allowanceTx = new AccountAllowanceApproveTransaction()
    //             .approveTokenAllowance(allowance.token_id, allowance.owner, allowance.spender, 0)
    //             .freezeWith(client);
    //         const allowanceSign = await allowanceTx.sign(PrivateKey.fromString(clientAccount.privateKey));
    //         const allowanceSubmit = await allowanceSign.execute(client);
    //         console.log(await allowanceSubmit.getReceipt(client));
    //     })

    return { client, clientAccount, feeAccount, signers };
}

module.exports = { init };